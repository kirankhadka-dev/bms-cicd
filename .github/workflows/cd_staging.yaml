name: Deploy on Staging
on:
  push:
    branches: 
      - main
      
jobs:
  redeploy_everything:
    runs-on: ubuntu-latest
    name: Deploying everything to the staging cluster
    steps:
       - name: SSH Into server
         run: |
           echo "${{secrets.SSH_PRIVATE_KEY}}" > ~/ssh_key
           chmod 600 ~/ssh_key
           ssh -i ~/ssh_key root@170.64.171.142 '
             cd bms-cicd && git pull &&
             pnpm install && 
             pm2 restart http-server &&
             pm2 restart next-js &&
             pm2 restart web-server
           '